<div class="row wrapper border-bottom white-bg page-heading">
  <div class="col-sm-4">
    <h2>Responder Profile</h2>
    <ol class="breadcrumb">
      <li>
        <a href="<%= url_for :controller => 'dashboards', :action => 'dashboard_1' %>">Settings</a>
      </li>
      <li class="active">
        <strong>Profile</strong>
      </li>
    </ol>
  </div>
</div>
<div class="row">
  <div class="col-md-6">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
        <h5>Location Settings
          <small class="m-l-sm"></small>
        </h5>
        <div class="ibox-content">
          <div class="zipcode-display" id="zipcode-display">
            <%= simple_form_for current_responder, class: 'form-inline' do |f| %>
              <div class="form-group" id="responder_zipcode">
                <%= f.input :zipcode,
                            label: false,
                            class: 'form-control sr-only',
                            id: 'zipcode-input', input_html: {pattern: '[0-9]{4}'}, placeholder: current_responder.zipcode || '' %>
              </div>
              <div class="text-error"></div>
              <div id="city-state"></div>
              <%= f.submit 'Update Zipcode', class: 'btn btn-white' %>
            <% end %>
          </div>
          <!--<div class="ibox-footer">-->
          <!--<span class="pull-right">-->
          <!--The righ side of the footer-->
          <!--</span>-->
          <!--This is simple footer example-->
          <!--</div>-->
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="ibox float-e-margins">
      <div class="ibox-title">
        <h5>Personal Information
          <small class="m-l-sm"></small>
        </h5>
        <!--<div class="ibox-tools">-->
        <!--<a class="collapse-link">-->
        <!--<i class="fa fa-chevron-up"></i>-->
        <!--</a>-->
        <!--<a class="dropdown-toggle" data-toggle="dropdown" href="#">-->
        <!--<i class="fa fa-wrench"></i>-->
        <!--</a>-->
        <!--<ul class="dropdown-menu dropdown-user">-->
        <!--<li><a href="#">Config option 1</a>-->
        <!--</li>-->
        <!--<li><a href="#">Config option 2</a>-->
        <!--</li>-->
        <!--</ul>-->
        <!--<a class="close-link">-->
        <!--<i class="fa fa-times"></i>-->
        <!--</a>-->
        <!--</div>-->
        <div class="ibox-content">
          <div>
            <%= simple_form_for current_responder, class: 'form-inline' do |f| %>
              <div class="form-group">
                <%= f.input :first_name,
                            class: 'form-control sr-only',
                            placeholder: current_responder.first_name || '' %>
              </div>
              <div>
                <%= f.input :last_name,
                            class: 'form-control sr-only',
                            placeholder: current_responder.last_name || '' %>
              </div>
              <div class="text-error"></div>
              <div id="city-state"></div>
              <%= f.button :button, class: 'btn btn btn-info btn-trans' do %>
                <i class='fas fa-save'></i>
                Save
              <% end %>

            <% end %>
          </div>
          <!--<div class="ibox-footer">-->
          <!--<span class="pull-right">-->
          <!--The right side of the footer-->
          <!--</span>-->
          <!--This is simple footer example-->
          <!--</div>-->
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<script type="text/javascript">//<![CDATA[
$(function () {
    var clientKey = 'js-or5260CuimzMSvL9uJwRcTOO4rfCbywW4HhEWe2z59GgZr6iF6RjFJux57zZyTnX';
    // var clientKey = "thmAfmVjv2OcZRh8Cf62K7wxUp42bE6fN8F6D2YQ9TBudxInnimucRPaCYia9zd2";

    var cache = {};
    var container = $("#zipcode-display");
    var errorDiv = container.find("div.text-error");

    /** Handle successful response */
    function handleResp(data) {
        // Check for error
        if (data.error_msg)
            errorDiv.text(data.error_msg);
        else if ("city" in data) {
            // Set city and state
            container.find("#city-state").text(data.city + ',' + data.state);
            // container.find("input[name='state']").val(data.state);
        }
    }

    // Set up event handlers
    $('#responder_zipcode').on("keyup change", function () {
        // Get zip code
        var zipcode = $(this).val().substring(0, 5);
        if (zipcode.length == 5 && /^[0-9]+$/.test(zipcode)) {
            // Clear error
            errorDiv.empty();

            // Check cache
            if (zipcode in cache) {
                handleResp(cache[zipcode]);
            }
            else {
                // Build url
                var url = "https://www.zipcodeapi.com/rest/" + clientKey + "/info.json/" + zipcode + "/radians";

                // Make AJAX request
                $.ajax({
                    "url": url,
                    "dataType": "json"
                }).done(function (data) {
                    handleResp(data);

                    // Store in cache
                    cache[zipcode] = data;
                }).fail(function (data) {
                    if (data.responseText && (json = $.parseJSON(data.responseText))) {
                        // Store in cache
                        cache[zipcode] = json;

                        // Check for error
                        if (json.error_msg)
                            errorDiv.text(json.error_msg);
                    }
                    else
                        errorDiv.text('Request failed.');
                });
            }
        }
    }).trigger("change");
});
//]]></script>