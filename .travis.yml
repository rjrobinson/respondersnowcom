branches:
  only:
    - /.*/
dist: bionic
language: ruby
env:
  matrix:
    - RAILS_ENV=test
cache:
  bundler: true
addons:
  postgresql: '9.6'
services:
  - redis-server
before_install:
  - |
    if ! git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qvE '(.md)|(.png)|(.pdf)|(.html)|^(LICENSE)|^(docs)'
    then
      echo "Only doc files were updated, not running the CI."
      exit
    fi
before_script:
  - bundle exec rails db:create

script:
  - bundle exec rails db:schema:load
  - bundle exec rails db:test:prepare
  - spring rspec
#  - bundle exec rubocop
#  - bundle exec brakeman --safe-methods ap